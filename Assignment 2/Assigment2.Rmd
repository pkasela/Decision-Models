---
title: "Assigment 2 - Alloy Corporation"
author: "Pranav Kasela - 846965"
output:
  pdf_document:
    fig_caption: yes
  html_document:
    df_print: paged
---

# Introduction

The **Manifacturing INC** (MNC) makes four different metal alloys: A, B, C and D.
The company is barely able to keep up with the increasing demand for these products. However, increasing raw material prices and foreign competition are forcing MNC to watch its margins to ensure it is operating in the most efficient manner possible.

# Marketing Demands

To meet marketing demands for the coming week, MNC needs to produce

- at least 1,200 pounds of the A product,
- between 450 and 650 pounds of the B product,
- no more than 120 pounds of the C product, and
- no more than 150 pounds of D product.


# Production Requirements

Each pound of the A, B, C, and D product contains, respectively, 55%, 45%, 25%, and 100% aluminum made up of copper.

The company has 1300 pounds of aluminum and 900 pounds of copper copper for use in the next week.

The various products are made using four different machines: forger, reamer, shaper, and planer. The following table summarizes the time required by each product on each machine. Each machine has 60 hours of time available in the coming week.

![Districts](img/minutes.png)

# Financial summary

The controller recently presented management with the following financial summary of MNC's average weekly operations over the past quarter. From this report, the controller is arguing that the company should cease producing its B and C products.

![Financial summary](img/costi.png)

# Questions
a. Do you agree with the controller's recommendation? Why or why not?
b. Formulate an LP model for this problem.
c. Create a executable model in R for this problem and solve it.
d. What is the optimal solution?
e. Perform the sensitivity analysis for this solution and answer the following questions.
f. Is the solution degenerate?
g. Is the solution unique?
h. If MNC wanted to decrease the production on any product, which one would you recommend and why?
i. If MNC wanted to increase the production of any product, which one would you recommend and why?
j. Which resources are preventing MNS from making more money? If they could acquire more of this resource how much should they acquire & how much should they be willing to pay to acquire it?
k. How much should MNC be willing to pay to acquire more copper?
l. If the marketing department wanted to decrease the price of the A product by $0.25, would the optimal solution change?

# Solutions
## a. Do you agree with the controllerâ€™s recommendation? Why or why not?

**We don't agree with the controller's recommendation**, we have that using the current combination of Products, the *Product B* has negative net profit (-0.12 per Pound) while the *Product C* has positive net profit (1.5 per Pound).
If we used the net profit as a performance measure of the products,which implies that the demand of the products will not change in the future, the controller would right on the cessation of the production of the *Product B* but not of the *Product C*. \newline 
But as we can see that the demand of the *Product B* changed, using the current minimum amount for the product B we have that the net profit in this case would be *amount*$\cdot$*Margin per Pound*(From the table below)$-$*Variable Costs* = $1.125*450 - 500 = 6.25 > 0$ which is positive thus profitable, but comparatively a small profit. If we could allocate the resources spent for the Product B in other Products we will have a better profit since the marginal profit for the Product B is the lowest one ($1.13$).\newline
The interruption in the production of the *Product B* is still arguable and depends a lot also on the market request, but in the case of the *Product C* we see that the marginal profit per Pound is $4.00$, and it has a fixed cost of only $250$, lowest one in all four products, thus we need to produce only $63$ pounds of Product C to have a profit, as long as this demand is satisfied (in the last quarter it was satified) there is no need to interrupt the production of the Product C. 


## b. Formulate an LP model for this problem.

Our objective is to maximize the profit, for that we define the *Margin Profit* as the *Sales Revenue*-*Variable Costs* and the Margin Profit per Pound as *Margin Profit*/*Pounds Sold*, we ignore the fixed costs because if we included them, since they are constant, they will go on the right hand side of the objective function and will not change the problem itself.
```{r table 1, echo=FALSE}
library(knitr)

Product <- c("Sales Revenue","Variable Costs","Margin","Pounds Sold","Margin per Pound")
A <- c("5769","3200","2569","1200","2.14")
B <- c("2000","1550","450","400","1.13")
C <- c("700","300","400","100","4.00")
D <- c("879","350","529","250","2.12")

kable(data.frame(Product,A,B,C,D))
```

So, indicated with A the pound sold of Product A (same for B, C and D) , the **objective function** is:

\[
2.14 \cdot A + 1.13 \cdot B + 4 \cdot C + 2.12 \cdot D
\]


The domain of the variables are:
\begin{align*}
1200 &\leq A < +\infty \\
450 &\leq B \leq 650\\
0 &\leq C \leq 120\\
0 &\leq D \leq 150\\ 
\end{align*}

Based on the composition of the material in each Product and the limited resources we also have that:

\begin{align*}
0.55 \cdot A + 0.45 \cdot B + 0.25 \cdot C + 1.00 \cdot D &\leq 1300 &\to &\text{Maximum Alminium}\\
0.45 \cdot A + 0.55 \cdot B + 0.75 \cdot C + 0.00 \cdot D &\leq 900 &\to &\text{Maximum Copper}
\end{align*}

We also have a time limit on each Machine, so the following constraint is also valid:

\begin{align*}
1.20\cdot A + 1.00\cdot B + 1.00 \cdot C + 1.50\cdot D &\leq 3600 &\to &\text{Forger}\\
1.75\cdot A + 1.00\cdot B + 1.00 \cdot C + 1.50\cdot D &\leq 3600 &\to &\text{Reamer}\\
1.30\cdot A + 0.60\cdot B + 0.40 \cdot C + 0.00\cdot D &\leq 3600 &\to &\text{Shaper}\\
2.50\cdot A + 1.20\cdot B + 2.00 \cdot C + 1.50\cdot D &\leq 3600 &\to &\text{Planer}
\end{align*}

## c. Create a executable model in R for this problem and solve it.

Here is the implementation of problem defined above in point **b.** in R:

```{r LP model, message=FALSE, results='hide'}
if(require(lpSolveAPI)==FALSE) install.packages("lpSolveAPI")
model = make.lp(0,4)                            # 4 Variables (A,B,C,D)
lp.control(model, sense = "max")                #Maximazing Problem
set.objfn(model,obj = c(2.141,1.125,4,2.116))   #Objective function coefficients

row.add.mode(model,"on")

add.constraint(model,
               xt = c(0.55,0.45,0.25,1),
               type = "<=",
               rhs = 1300,
               indices = c(1:4)) #Aluminium Constraint

add.constraint(model,
               xt = c(0.45,0.55,0.75,0),
               type = "<=",
               rhs = 900,
               indices = c(1:4)) #Copper Constraint

add.constraint(model,
               xt = c(1.2,1,1,1.5),
               type = "<=",
               rhs = 3600,
               indices = c(1:4)) #Forger Time Constraint

add.constraint(model,
               xt = c(1.75,1,1,1.5),
               type = "<=",
               rhs = 3600,
               indices = c(1:4)) #Reamer Time Constraint

add.constraint(model,
               xt = c(1.3,0.6,0.4,0),
               type = "<=",
               rhs = 3600,
               indices = c(1:4)) #Shaper Time Constraint

add.constraint(model,
               xt = c(2.5,1.2,2,1.5),
               type = "<=",
               rhs = 3600,
               indices = c(1:4)) #Planer Time Constraint

#Setting lower and upper bounds
set.bounds(model,lower = c(1200,450,0,0), upper = c(Inf,650,120,150)) 

row.add.mode(model,"off")

#Giving names to the contraints and variables
dimnames(model)<- list(c("Aluminium","Copper","Forger","Reamer","Shaper","Planer"),
                       c("A","B","C","D"))
name.lp(model, "Alloy Corporation")
```

```{r LP model print}
print(model) #To see to model
```


## d. What is the optimal solution?

We use the solve() function to solve the model:
```{r LP model solution}
solve(model) #result = 0 -> solved

solution <- get.variables(model)
fixed_cost <- 1650
cat("The optimal variables values are:","\n",
    "A <-",solution[1],", B <-",solution[2],
    ", C <-",solution[3],", D <-",solution[4])

cat("The optimal objective function value is: ",get.objective(model), "\n",
    "Thus the optimal net profit value is",get.objective(model) - fixed_cost)
```

## e. Perform the sensitivity analysis for this solution and answer the following questions.

```{r sensitivity function, include=FALSE}
require(dplyr)
require(tidyr)

printSensitivityRHS <- function(model, numVars){
  arg.rhs <- get.sensitivity.rhs(model)
  arg.rhs$dualsfrom <- round(arg.rhs$dualsfrom,3)
  arg.rhs$dualstill <- round(arg.rhs$dualstill,3)
  numVars <- length(get.variables(model))
  numRows <- length(arg.rhs$duals)
  
   symb <- c() 
   for (i in c(1:numRows)) { 
     symb[i] <- paste("B", i, sep = "" ) 
   }
   
  rhs <- data.frame(rhs = symb,duals=arg.rhs$duals,arg.rhs)
  
  rhs<-rhs %>%
  mutate(dualsfrom=replace(dualsfrom, dualsfrom < -1e10, "-inf")) %>%
  mutate(dualstill=replace(dualstill, dualstill > 1e10, "inf")) %>%
    unite(col = "Sensitivity",  
          dualsfrom, rhs, dualstill , 
          sep = " <= ", remove = FALSE) %>%
    select(c("rhs","duals","Sensitivity"))
  
  colnames(rhs)[1]<-c('Rhs')
  print(rhs[1:(numRows-numVars),])
  #print(rhs)
}

printSensitivityObj <- function(model){
  arg.obj = get.sensitivity.obj(model)
  #rounding stuff
  arg.obj$objfrom <- round(arg.obj$objfrom,3)
  arg.obj$objtill <- round(arg.obj$objtill,3)
  
  numRows <- length(arg.obj$objfrom)
   symb <- c() 
   for (i in c(1:numRows)) { 
     symb[i] <- paste("C", i, sep = "" ) 
   }
   
  obj <- data.frame(Objs = symb, arg.obj)
  obj<-
    obj %>%
    mutate(objfrom=replace(objfrom, objfrom < -1e10, "-inf")) %>%
    mutate(objtill=replace(objtill, objtill > 1e10, "inf")) %>%
    unite(col = "Sensitivity",  
          objfrom, Objs, objtill , 
          sep = " <= ", remove = FALSE) %>%
    select(c("Objs","Sensitivity"))
    print(obj)
}
```

```{r sensitivity analysis Obj}
printSensitivityObj(model)
```
We have that the base remains if the coeffiecient are in the following range:

\begin{align*}
-\infty &< C_1 \leq 5\\
-\infty &< C_2 \leq 2.4\\
2.821  &\leq C_3 < +\infty\\
-\infty &< C_4 < 3\\
\end{align*}
The fact that $C_1$ and $C_2$ can decrease all they want is due to the fact that the optimal solution satisfies the minimum constraint given for Product A and B, thus if we were to decrease the marginal profit per pound from how it is now, we will have that it still needs to satify the minimum quantity for Product A and B, so the solution will not change.<br>\newline
A similar argument applies for the coefficient $C_4$ of Product D, if we decrease $C_4$ the solution will not change since we will continue to not produce the Product C with the given constraints.<br>\newline
While for the coefficient $C_3$  if we increase it, since we produce only the product C, because the most profitable while satifying the given contraints even if we increased the obtained profit we will have that the optimal solution will not change.
```{r sensitivity analysis RHS}
printSensitivityRHS(model)
```
So we have the the dual variables are $y_i = 0, \forall i=1,...,5$ and $y_6=2$ and the interval for the resources are:
\begin{align*}
-\infty &< b_1 < +\infty\\
-\infty &< b_2 < +\infty\\
-\infty &< b_3 < +\infty\\
-\infty &< b_4 < +\infty\\
-\infty &< b_5 < +\infty\\
3540 &\leq b_6 \leq 3780
\end{align*}

All the shadow prices except for the last one are $0$ thus a small change in these contraints will not affect the solution.<br>\newline 
The last contraint (Planer Time) has a shadow price of 2, which means that every minute we add/subtract to the planer time (staying in the given interval [3540,3780]), the value of the optimal solution increases/decreases by 2.

## f. Is the solution degenerate?

There are two was of checking if a solution is degenrate, the first one is using the theory: we have that since no constraint has an allowable increase or decrease $= 0$, the solution is not degenerate.<br>\newline
Another way is using the value of the following function:
```{r degenerate}
solve.lpExtPtr(model)
```
If the function has a value of 4 it means that the solution is degenerate, while 0 means that the optimal solution is found. In this case the value of the function confirms that the solution is not degenerate.

## g. Is the solution unique?

```{r unique solution}
get.solutioncount(model)
```
This function counts the number of solution for the model, in this case the result is 1, thus there is only one unique solution.<br>\newline
We could also see that the first two quantities for Product A and B are the minimum market's requirement and the rest of the resources are allocated for the Product C which is the most profitable one. So it is reasonable to think that the obtained solution is the only best possibility. For example after satifying the market's minimun requirement for the Product A and B, if we were to allocate the resources for any product but C, the net profit will not go up as much as with the Product C, given that the production time of C is more or less the same as the other products.

## h. If MNC wanted to decrease the production on any product, which one would you recommend and why?

Given the marginal profit per Pound, we would recommend decreasing the Production of the Product B, in order to allocate the resources for a more profitable Product.

## i. If MNC wanted to increase the production of any product, which one would you recommend and why?

In this case we would recommend the increase in production of the Product C, which is the most profitable one.

## j.Which resources are preventing MNS from making more money? If they could acquire more of this resource how much should they acquire & how much should they be willing to pay to acquire it?

```{r constraint values}
get.constraints(model)
```
The Planer time is the one which is preventing us to produce ant other product (because it's value is $=3600$ which is the limit), since it's shadow price is 2, if we buy 180 minutes more the value of the function will increase by $y_6 \times \Delta_2 = 2 \times 180 = 360$. So the company must pay at most 360 to increase the time by $180$ minutes in the Planer machine.

## k. How much should MNC be willing to pay to acquire more copper?

From the point j. we can see that the quantity of Copper used is 810, while the company has an available quantity of 900, thus MNC doesn't need extra copper, so the answer is 0. 

## l. If the marketing department wanted to decrease the price of the A product by $0.25, would the optimal solution change?

During the sensitivity analysis we saw that the the coefficient $C_1$ for the product A can decrease a lot without changing the optimal solution, so if we decrease it by $0.25$ the optimal solution will not change, only the value of the function will change.<br>\newline
We can confirm it (even though it's unnecessary) creating a new model with the new coefficient for Product A.

```{r Product A Price Decrease}
model2 <- model #We just change the objective function
set.objfn(model2,obj=c(2.141-0.25,1.125,4,2.116))
solve(model2)
cat(" New Model: ", get.variables(model2),"\n",
    "Old Model: ", get.variables(model))
cat("New value of the funtion: ", get.objective(model2))
```